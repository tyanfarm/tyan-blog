"use strict";(self.webpackChunktyan_blog=self.webpackChunktyan_blog||[]).push([[422],{9276:(n,i,e)=>{e.r(i),e.d(i,{assets:()=>s,contentTitle:()=>l,default:()=>o,frontMatter:()=>r,metadata:()=>c,toc:()=>a});const c=JSON.parse('{"id":"build-llm-from-scratch/llm-architecture-01","title":"4. LLM Architecture (Part 01)","description":"4.1. Code LLM architecture","source":"@site/docs/build-llm-from-scratch/4. llm-architecture-01.md","sourceDirName":"build-llm-from-scratch","slug":"/build-llm-from-scratch/llm-architecture-01","permalink":"/tyan-blog/docs/build-llm-from-scratch/llm-architecture-01","draft":false,"unlisted":false,"editUrl":"https://github.com/tyanfarm/tyan-blog/tree/main/docs/build-llm-from-scratch/4. llm-architecture-01.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8,"title":"4. LLM Architecture (Part 01)"},"sidebar":"tutorialSidebar","previous":{"title":"3. Coding Attention Mechanisms (Part 05)","permalink":"/tyan-blog/docs/build-llm-from-scratch/attention-mechanisms-05"},"next":{"title":"Normalization","permalink":"/tyan-blog/docs/build-llm-from-scratch/bonus-section/normalization"}}');var h=e(4848),t=e(8453);const r={sidebar_position:8,title:"4. LLM Architecture (Part 01)"},l=void 0,s={},a=[{value:"4.1. Code LLM architecture",id:"41-code-llm-architecture",level:2},{value:"GPT Backbone",id:"gpt-backbone",level:3},{value:"Layer Normalization",id:"layer-normalization",level:3},{value:"H\xe0m k\xedch ho\u1ea1t (Activations)",id:"h\xe0m-k\xedch-ho\u1ea1t-activations",level:5},{value:"Chi\u1ec1u (dimension) khi t\xednh <em>mean</em>",id:"chi\u1ec1u-dimension-khi-t\xednh-mean",level:5},{value:"GeLU Activations",id:"gelu-activations",level:3},{value:"Feed Forward Network",id:"feed-forward-network",level:3}];function d(n){const i={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",h5:"h5",img:"img",li:"li",p:"p",ul:"ul",...(0,t.R)(),...n.components};return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(i.h2,{id:"41-code-llm-architecture",children:"4.1. Code LLM architecture"}),"\n",(0,h.jsx)(i.h3,{id:"gpt-backbone",children:"GPT Backbone"}),"\n",(0,h.jsxs)(i.ul,{children:["\n",(0,h.jsxs)(i.li,{children:["\n",(0,h.jsx)(i.p,{children:"C\xe1c m\xf4 h\xecnh Ng\xf4n ng\u1eef l\u1edbn (LLM) nh\u01b0 GPT (Generative Pretrained Transformer) l\xe0 nh\u1eefng ki\u1ebfn tr\xfac m\u1ea1ng n\u01a1-ron c\xf3 k\xedch th\u01b0\u1edbc kh\u1ed5ng l\u1ed3."}),"\n"]}),"\n",(0,h.jsxs)(i.li,{children:["\n",(0,h.jsx)(i.p,{children:"Tuy nhi\xean, ki\u1ebfn tr\xfac c\u1ee7a m\xf4 h\xecnh n\xe0y th\u1ef1c ch\u1ea5t l\u1ea1i \xedt ph\u1ee9c t\u1ea1p h\u01a1n b\u1ea1n t\u01b0\u1edfng, b\u1edfi nhi\u1ec1u th\xe0nh ph\u1ea7n b\xean trong \u0111\u01b0\u1ee3c l\u1eb7p \u0111i l\u1eb7p l\u1ea1i (ch\xfang ta s\u1ebd t\xecm hi\u1ec3u sau)."}),"\n"]}),"\n",(0,h.jsxs)(i.li,{children:["\n",(0,h.jsx)(i.p,{children:(0,h.jsx)(i.img,{alt:"alt",src:e(6270).A+"",width:"896",height:"718"})}),"\n"]}),"\n",(0,h.jsxs)(i.li,{children:["\n",(0,h.jsxs)(i.p,{children:["Ph\xeda tr\xean l\xe0 h\xecnh m\xf4 t\u1ea3 t\u1ed5ng qu\xe1t v\u1ec1 ",(0,h.jsx)(i.em,{children:"1 m\xf4 h\xecnh GPT"}),". B\xean c\u1ea1nh c\xe1c ",(0,h.jsx)(i.code,{children:"embedding layers"})," & ",(0,h.jsx)(i.code,{children:"inputs tokenization"}),", n\xf3 bao g\u1ed3m ",(0,h.jsx)(i.em,{children:"1 ho\u1eb7c nhi\u1ec1u"})," kh\u1ed1i ",(0,h.jsx)(i.code,{children:"Transformer"})," ch\u1ee9a module ",(0,h.jsx)(i.code,{children:"masked multi-head attention"})," (\u0111\xe3 tri\u1ec3n khai \u1edf ch\u01b0\u01a1ng tr\u01b0\u1edbc)."]}),"\n"]}),"\n",(0,h.jsxs)(i.li,{children:["\n",(0,h.jsxs)(i.p,{children:["Tr\u1ecdng t\xe2m \u1edf ch\u01b0\u01a1ng n\xe0y s\u1ebd tri\u1ec3n khai ",(0,h.jsx)(i.em,{children:"core"})," c\u1ee7a LLM, bao g\u1ed3m c\xe1c ",(0,h.jsx)(i.em,{children:"kh\u1ed1i transformer"}),", sau \u0111\xf3 ch\xfang ta s\u1ebd ",(0,h.jsx)(i.em,{children:"hu\u1ea5n luy\u1ec7n"})," \u1edf ch\u01b0\u01a1ng ti\u1ebfp theo \u0111\u1ec3 t\u1ea1o ra v\u0103n b\u1ea3n gi\u1ed1ng con ng\u01b0\u1eddi."]}),"\n"]}),"\n",(0,h.jsxs)(i.li,{children:["\n",(0,h.jsx)(i.p,{children:"D\u01b0\u1edbi \u0111\xe2y l\xe0 m\xf4 t\u1ea3 c\xe1c b\u01b0\u1edbc \u0111\u1ec3 build 1 m\xf4 h\xecnh GPT ho\xe0n ch\u1ec9nh."}),"\n"]}),"\n",(0,h.jsxs)(i.li,{children:["\n",(0,h.jsx)(i.p,{children:(0,h.jsx)(i.img,{alt:"alt",src:e(1319).A+"",width:"1068",height:"449"})}),"\n"]}),"\n",(0,h.jsxs)(i.li,{children:["\n",(0,h.jsxs)(i.p,{children:["B\u1eaft \u0111\u1ea7u v\u1edbi b\u01b0\u1edbc \u0111\u1ea7u ti\xean l\xe0 x\xe2y d\u1ef1ng ",(0,h.jsx)(i.code,{children:"GPT Backbone"}),", ta s\u1ebd tri\u1ec3n khai 1 class l\xe0 ",(0,h.jsx)(i.code,{children:"DummyGPTModel"})," - phi\xean b\u1ea3n \u0111\u01a1n gi\u1ea3n h\xf3a c\u1ee7a m\xf4 h\xecnh GPT, s\u1eed d\u1ee5ng module neural network c\u1ee7a Pytorch ",(0,h.jsx)(i.em,{children:"nn.Module"}),". Ki\u1ebfn tr\xfac c\u1ee7a m\xf4 h\xecnh \u0111\u01b0\u1ee3c tri\u1ec3n khai t\u1ea1i ph\u1ea7n ",(0,h.jsx)(i.code,{children:"1. GPT Backbone"})," trong ",(0,h.jsx)(i.a,{href:"https://github.com/tyanfarm/build-LLM-from-scratch-notebook/blob/main/11.%20Placeholder-GPT.ipynb",children:(0,h.jsx)(i.code,{children:"11. Placeholder-GPT.ipynb"})}),"."]}),"\n"]}),"\n"]}),"\n",(0,h.jsx)(i.h3,{id:"layer-normalization",children:"Layer Normalization"}),"\n",(0,h.jsxs)(i.ul,{children:["\n",(0,h.jsxs)(i.li,{children:["\n",(0,h.jsxs)(i.p,{children:["Vi\u1ec7c hu\u1ea5n luy\u1ec7n ",(0,h.jsx)(i.code,{children:"deep neural network"})," (m\u1ea1ng n\u01a1-ron s\xe2u) v\u1edbi nhi\u1ec1u t\u1ea7ng ",(0,h.jsx)(i.code,{children:"hidden layer"})," d\u1ec5 g\u1eb7p v\u1ea5n \u0111\u1ec1 nh\u01b0 ",(0,h.jsx)(i.em,{children:"vanishing gradient (tri\u1ec7t ti\xeau \u0111\u1ea1o h\xe0m)"})," hay ",(0,h.jsx)(i.em,{children:"exploding gradient (b\xf9ng n\u1ed5 \u0111\u1ea1o h\xe0m)"}),". \u0110i\u1ec1u n\xe0y c\xf3 ngh\u0129a m\xf4 h\xecnh s\u1ebd g\u1eb7p kh\xf3 kh\u0103n trong vi\u1ec7c t\xecm ra b\u1ed9 tham s\u1ed1 t\u1ed1i \u01b0u \u0111\u1ec3 gi\u1ea3m ",(0,h.jsx)(i.em,{children:"loss"}),"."]}),"\n"]}),"\n",(0,h.jsxs)(i.li,{children:["\n",(0,h.jsxs)(i.p,{children:["Ph\u1ea7n n\xe0y ch\xfang ta s\u1ebd tri\u1ec3n khai ",(0,h.jsx)(i.code,{children:"layer normalization"}),". \xdd t\u01b0\u1edfng ch\xednh l\xe0 \u0111i\u1ec1u ch\u1ec9nh c\xe1c gi\xe1 tr\u1ecb k\xedch ho\u1ea1t (",(0,h.jsx)(i.code,{children:"activations"}),") \u0111\u1ea7u ra c\u1ee7a 1 ",(0,h.jsx)(i.em,{children:"hidden layer"})," sao cho ch\xfang c\xf3 ",(0,h.jsxs)(i.em,{children:["gi\xe1 tr\u1ecb trung b\xecnh (",(0,h.jsx)(i.a,{href:"/tyan-blog/docs/machine-learning/base-math/probability-statistics#trung-b%C3%ACnh-c%E1%BB%99ng-mean",children:"mean"}),")"]})," b\u1eb1ng 0 v\xe0 ",(0,h.jsxs)(i.em,{children:["ph\u01b0\u01a1ng sai (",(0,h.jsx)(i.a,{href:"/tyan-blog/docs/machine-learning/base-math/probability-statistics#ph%C6%B0%C6%A1ng-sai-variance",children:"variance"}),")"]})," b\u1eb1ng 1 - vi\u1ec7c \u0111i\u1ec1u ch\u1ec9nh ",(0,h.jsx)(i.em,{children:"mean"})," & ",(0,h.jsx)(i.em,{children:"variance"})," n\xe0y l\xe0 c\u1ee7a ",(0,h.jsx)(i.a,{href:"/tyan-blog/docs/build-llm-from-scratch/bonus-section/normalization#standardization-z-score-normalization",children:"Standardization"}),". \u0110\u1ec3 \xfd th\xeam 1 \u0111i\u1ec1u l\xe0 t\u1ea1i sao l\u1ea1i chu\u1ea9n h\xf3a theo 2 gi\xe1 tr\u1ecb n\xe0y, th\xec b\u1edfi v\xec ",(0,h.jsx)(i.a,{href:"/tyan-blog/docs/machine-learning/base-math/probability-statistics#ph%C3%A2n-ph%E1%BB%91i-chu%E1%BA%A9n-gaussiannormal-distribution",children:"Ph\xe2n ph\u1ed1i chu\u1ea9n"})," d\u1ef1a tr\xean 2 tham s\u1ed1 n\xe0y."]}),"\n"]}),"\n",(0,h.jsxs)(i.li,{children:["\n",(0,h.jsxs)(i.p,{children:["Trong ",(0,h.jsx)(i.em,{children:"GPT-2"})," v\xe0 c\xe1c ki\u1ebfn tr\xfac ",(0,h.jsx)(i.em,{children:"Transformer"})," hi\u1ec7n \u0111\u1ea1i, ",(0,h.jsx)(i.em,{children:"Layer Normalization"})," th\u01b0\u1eddng \u0111\u01b0\u1ee3c \xe1p d\u1ee5ng ",(0,h.jsx)(i.em,{children:"tr\u01b0\u1edbc v\xe0 sau"})," kh\u1ed1i ",(0,h.jsx)(i.em,{children:"multi-head attention"})," v\xe0 tr\u01b0\u1edbc ",(0,h.jsx)(i.em,{children:"output layer"}),"."]}),"\n",(0,h.jsx)(i.h5,{id:"h\xe0m-k\xedch-ho\u1ea1t-activations",children:"H\xe0m k\xedch ho\u1ea1t (Activations)"}),"\n",(0,h.jsxs)(i.ul,{children:["\n",(0,h.jsxs)(i.li,{children:["Khi \u0111i qua c\xe1c t\u1ea7ng ",(0,h.jsx)(i.em,{children:"Linear"})," th\xec m\xf4 h\xecnh ch\u1ec9 h\u1ecdc \u0111\u01b0\u1ee3c c\xe1c m\u1ed1i quan h\u1ec7 tuy\u1ebfn t\xednh."]}),"\n",(0,h.jsxs)(i.li,{children:["H\xe0m k\xedch ho\u1ea1t l\xfac n\xe0y gi\xfap m\xf4 h\xecnh h\u1ecdc th\xeam c\xe1c m\u1ed1i quan h\u1ec7 phi tuy\u1ebfn t\xednh. V\xed d\u1ee5 h\xe0m ",(0,h.jsx)(i.em,{children:"ReLU"})," chuy\u1ec3n c\xe1c gi\xe1 tr\u1ecb \xe2m v\u1ec1 0."]}),"\n"]}),"\n"]}),"\n",(0,h.jsxs)(i.li,{children:["\n",(0,h.jsxs)(i.p,{children:["Tr\u01b0\u1edbc khi \u0111i v\xe0o ph\u1ea7n tri\u1ec3n khai code ta h\xe3y xem qua s\u01a1 \u0111\u1ed3 t\u1ed5ng quan c\u1ee7a ",(0,h.jsx)(i.em,{children:"layer normalization"}),":"]}),"\n"]}),"\n",(0,h.jsxs)(i.li,{children:["\n",(0,h.jsx)(i.p,{children:(0,h.jsx)(i.img,{alt:"alt",src:e(2368).A+"",width:"1137",height:"691"})}),"\n"]}),"\n",(0,h.jsxs)(i.li,{children:["\n",(0,h.jsxs)(i.p,{children:["\u1ede h\xecnh tr\xean, khi \u0111i qua t\u1ea7ng ",(0,h.jsx)(i.em,{children:"hidden layer"})," th\xec c\xe1c gi\xe1 tr\u1ecb \u0111\u1ea7u ra s\u1ebd \u0111\u01b0\u1ee3c t\xednh to\xe1n \u0111\u1ec3 \u0111\u01b0a v\u1ec1 tr\u1ea1ng th\xe1i c\xf3 ",(0,h.jsx)(i.em,{children:"mean b\u1eb1ng 0 & variance b\u1eb1ng 1"}),". Qu\xe1 tr\xecnh n\xe0y gi\xfap \u1ed5n \u0111\u1ecbnh d\xf2ng d\u1eef li\u1ec7u v\xe0 t\u0103ng t\u1ed1c \u0111\u1ed9 h\u1ed9i t\u1ee5 m\xf4 h\xecnh."]}),"\n"]}),"\n",(0,h.jsxs)(i.li,{children:["\n",(0,h.jsxs)(i.p,{children:["Code \u0111\u01b0\u1ee3c tri\u1ec3n khai t\u1ea1i ph\u1ea7n ",(0,h.jsx)(i.code,{children:"2. Layer Normalization"})," trong ",(0,h.jsx)(i.a,{href:"https://github.com/tyanfarm/build-LLM-from-scratch-notebook/blob/main/11.%20Placeholder-GPT.ipynb",children:(0,h.jsx)(i.code,{children:"11. Placeholder-GPT.ipynb"})}),"."]}),"\n",(0,h.jsxs)(i.h5,{id:"chi\u1ec1u-dimension-khi-t\xednh-mean",children:["Chi\u1ec1u (dimension) khi t\xednh ",(0,h.jsx)(i.em,{children:"mean"})]}),"\n",(0,h.jsxs)(i.ul,{children:["\n",(0,h.jsxs)(i.li,{children:["\n",(0,h.jsx)(i.p,{children:(0,h.jsx)(i.img,{alt:"alt",src:e(9074).A+"",width:"767",height:"543"})}),"\n"]}),"\n",(0,h.jsxs)(i.li,{children:["\n",(0,h.jsxs)(i.p,{children:["Tr\xean \u0111\xe2y l\xe0 m\xf4 t\u1ea3 v\u1ec1 chi\u1ec1u t\xednh to\xe1n ",(0,h.jsx)(i.em,{children:"mean"})," tr\xean 1 tensor 2D ",(0,h.jsx)(i.em,{children:"[rows, columns]"}),"."]}),"\n"]}),"\n",(0,h.jsxs)(i.li,{children:["\n",(0,h.jsxs)(i.p,{children:["Vi\u1ec7c s\u1eed d\u1ee5ng ",(0,h.jsx)(i.code,{children:"dim=-1"})," gi\xfap t\xednh ",(0,h.jsx)(i.em,{children:"mean"})," tr\xean chi\u1ec1u cu\u1ed1i c\xf9ng c\u1ee7a tensor. Sau n\xe0y, khi th\xeam ",(0,h.jsx)(i.em,{children:"chu\u1ea9n h\xf3a l\u1edbp (layer normalization)"})," - n\u01a1i t\u1ea1o ra tensor 3D ",(0,h.jsx)(i.em,{children:"[batch_size, num_tokens, embedding_dim]"})," th\xec vi\u1ec7c gi\u1eef nguy\xean ",(0,h.jsx)(i.em,{children:"dim=-1"})," linh ho\u1ea1t h\u01a1n nhi\u1ec1u so v\u1edbi ph\u1ea3i thay \u0111\u1ed5i th\u1ee7 c\xf4ng t\u1eeb ",(0,h.jsx)(i.em,{children:"dim=1"})," sang ",(0,h.jsx)(i.em,{children:"dim=2"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,h.jsxs)(i.li,{children:["\n",(0,h.jsx)(i.p,{children:(0,h.jsx)(i.img,{alt:"alt",src:e(3126).A+"",width:"1160",height:"542"})}),"\n"]}),"\n",(0,h.jsxs)(i.li,{children:["\n",(0,h.jsxs)(i.p,{children:["Ph\u1ea7n sau ta s\u1ebd t\xecm hi\u1ec3u v\u1ec1 ",(0,h.jsx)(i.em,{children:"h\xe0m k\xedch ho\u1ea1t"})," ",(0,h.jsx)(i.code,{children:"GeLU"})," - m\u1ed9t trong c\xe1c h\xe0m k\xedch ho\u1ea1t d\xf9ng trong LLMs, thay cho h\xe0m truy\u1ec1n th\u1ed1ng ",(0,h.jsx)(i.em,{children:"ReLU"}),"."]}),"\n"]}),"\n"]}),"\n",(0,h.jsx)(i.h3,{id:"gelu-activations",children:"GeLU Activations"}),"\n",(0,h.jsx)(i.h3,{id:"feed-forward-network",children:"Feed Forward Network"})]})}function o(n={}){const{wrapper:i}={...(0,t.R)(),...n.components};return i?(0,h.jsx)(i,{...n,children:(0,h.jsx)(d,{...n})}):d(n)}},6270:(n,i,e)=>{e.d(i,{A:()=>c});const c=e.p+"assets/images/llm-01-overall-9f1a2afeabbd3dd399cb799f9ec12340.png"},1319:(n,i,e)=>{e.d(i,{A:()=>c});const c=e.p+"assets/images/llm-02-backbone-94bbd0e89891c8135cd9d125e80475a3.png"},2368:(n,i,e)=>{e.d(i,{A:()=>c});const c=e.p+"assets/images/llm-03-layer-normalization-e53a3b19c6f8b2711e0e1a0733f025d7.png"},9074:(n,i,e)=>{e.d(i,{A:()=>c});const c=e.p+"assets/images/llm-04-mean-dimension-b5bb8156ae979990ecee13efac25605d.png"},3126:(n,i,e)=>{e.d(i,{A:()=>c});const c=e.p+"assets/images/llm-05-layernorm-finish-f8b352c7b528ce5c9f626aaaa4eca672.png"},8453:(n,i,e)=>{e.d(i,{R:()=>r,x:()=>l});var c=e(6540);const h={},t=c.createContext(h);function r(n){const i=c.useContext(t);return c.useMemo((function(){return"function"==typeof n?n(i):{...i,...n}}),[i,n])}function l(n){let i;return i=n.disableParentContext?"function"==typeof n.components?n.components(h):n.components||h:r(n.components),c.createElement(t.Provider,{value:i},n.children)}}}]);